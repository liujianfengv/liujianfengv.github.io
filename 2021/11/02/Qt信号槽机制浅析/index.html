
<!DOCTYPE html>
<html lang="en">
    <!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  
    <link rel="icon" href="/img/avatar.jpg">
  
  
      <meta name="author" content="Liujianfeng">
  
  
  
  
  
    <link rel="alternate" href="/atom.xml " title="åˆ˜å‰‘å³°" type="application/atom+xml">
  

  

  <title>Qtä¿¡å·æ§½æœºåˆ¶æµ…æ | åˆ˜å‰‘å³°</title>

  

  

  

  <link rel="stylesheet" href="/css/style.css" >
  <link rel="stylesheet" href="/css/partial/dark.css" >

  
  
  

  
    
      <link rel="stylesheet" href="/css/partial/highlight/atom-one-light.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/a2396837/CDN@latest/css/iconfont.css">
    
  

  
    <script src="/js/todark.js"></script>
    
<meta name="generator" content="Hexo 5.4.0"></head>
</html>
    
<div class="nav index" style="height: 60px;">
    <div class="title animated fadeInDown">
        <div class="layui-container">
                <div class="nav-title"><a href="/" title="åˆ˜å‰‘å³°">åˆ˜å‰‘å³°</a></div>
            <div class="nav-list">
                <button> <span class=""></span><span style="display: block;"></span><span class=""></span> </button>
                <ul class="layui-nav" lay-filter="">
                    
                    
                        <li class="layui-nav-item" id="btn-toggle-dark">ğŸŒ™</li>
                    
                    <span class="layui-nav-bar" style="left: 342px; top: 78px; width: 0px; opacity: 0;"></span>
                </ul>
            </div>
        </div>
    </div>
</div>
    
<header class="header">
        
            <div class="logo">
                    <a href="/"><img src="/img/avatar.jpg" onerror=this.onerror=null,this.src="/img/loading.gif"></a>
            </div>
         
    </div>
     

            <div class="motto">
                <span></span>
            </div>
    
     
</header>

    
<article id="post">
  <div class="post-title">Qtä¿¡å·æ§½æœºåˆ¶æµ…æ</div>
  
<div class="post-meta">
    
    
      <div class="post-meta-item date">
        <span title="Created 2021.11.02"><i class="far fa-calendar-alt"></i> 2021.11.02</span>
      </div>
      <div class="post-meta-item updated">
        <span title="Updated 2021.11.08"><i class="far fa-calendar-check"></i> 2021.11.08</span>
      </div>
     
     
    
     <div class="post-meta-item wordcount">
        
          <i class="fas fa-pencil-alt"></i> <span class="post-count">2.2k words</span>
           
        
          <i class="far fa-clock"></i> <span class="post-count">9 min</span>
                               
      </div>
     
</div>


  
  <div class="content">
        <div><p>Qtæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„C++è½¯ä»¶å¼€å‘æ¡†æ¶ï¼Œè€ŒQtçš„æ ¸å¿ƒæœºåˆ¶æ˜¯ä¿¡å·æ§½ï¼Œå…³äºä¿¡å·æ§½ï¼ŒQtå®˜æ–¹çš„è¡¨è¿°æ˜¯:</p>
<span id="more"></span>
<blockquote>
<p><code>Signals and slots are used for communication between objects. The signals and slots mechanism is a central feature of Qt and probably the part that differs most from the features provided by other frameworks. Signals and slots are made possible by Qt&#39;s meta-object system.</code></p>
</blockquote>
<p>ä¿¡å·å’Œæ§½è¢«ç”¨äºå¯¹è±¡é—´çš„æ²Ÿé€šï¼Œä¿¡å·æ§½æœºåˆ¶æ˜¯Qtçš„æ ¸å¿ƒç‰¹ç‚¹ï¼Œä¹Ÿæ˜¯Qtä¸å…¶ä»–åº”ç”¨æ¡†æ¶çš„ä¸åŒä¹‹å¤„ï¼Œä¿¡å·æ§½çš„æœºåˆ¶å¾—ç›ŠäºQtçš„å…ƒå¯¹è±¡ç³»ç»Ÿã€‚<br>ä¸‹é¢åˆ†ä¸¤æ­¥æ¥å¯¹Qtçš„ä¿¡å·æ§½æœºåˆ¶åšä¸€ä¸ªç®€å•åˆ†æã€‚</p>
<h2 id="ä»Qtç¨‹åºçš„ç¼–è¯‘è¿‡ç¨‹è®²èµ·"><a href="#ä»Qtç¨‹åºçš„ç¼–è¯‘è¿‡ç¨‹è®²èµ·" class="headerlink" title="ä»Qtç¨‹åºçš„ç¼–è¯‘è¿‡ç¨‹è®²èµ·"></a>ä»Qtç¨‹åºçš„ç¼–è¯‘è¿‡ç¨‹è®²èµ·</h2><p>ä¸€ä¸ªæ™®é€šC++ç¨‹åºçš„ç¼–è¯‘éœ€è¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p>
<ul>
<li>é¢„å¤„ç†(Prepressing): ä¸»è¦å¤„ç†æºä»£ç ä¸­ä»¥â€œ#â€å¼€å§‹çš„é¢„ç¼–è¯‘å‘½ä»¤ï¼Œä¾‹å¦‚â€#includeâ€å°†è¢«åŒ…å«æ–‡ä»¶æ’å…¥åˆ°è¯¥æŒ‡ä»¤ä½ç½®ã€ å¤„ç†â€#ifâ€ã€â€ifdefâ€ç­‰æ¡ä»¶é¢„ç¼–è¯‘æŒ‡ä»¤ã€åˆ é™¤æ³¨é‡Š</li>
<li>ç¼–è¯‘(Compilation): å°†é¢„å¤„ç†å®Œçš„æ–‡ä»¶è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æç”Ÿæˆç›¸åº”çš„æ±‡ç¼–ä»£ç æ–‡ä»¶</li>
<li>æ±‡ç¼–(Assembly): å°†ç¼–è¯‘ç”Ÿæˆçš„æ±‡ç¼–ä»£ç è½¬åŒ–æˆæœºå™¨å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œç”Ÿæˆç›®æ ‡æ–‡ä»¶</li>
<li>é“¾æ¥(Linking): ç»„ç»‡æ±‡ç¼–ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å’Œç¼–è¯‘ç¯å¢ƒä¸‹ç›¸å…³çš„è¿è¡Œæ—¶åº“ï¼Œå°†å„ä¸ªæ¨¡å—ä¹‹é—´çš„ç›¸äº’å¼•ç”¨éƒ¨åˆ†å¤„ç†å¥½ï¼Œä½¿å¾—å„ä¸ªæ¨¡å—é—´èƒ½å¤Ÿæ­£ç¡®çš„è¡”æ¥<br>Qtç¨‹åºçš„ç¼–è¯‘ä¸C++ç¨‹åºçš„ç¼–è¯‘ä¸»è¦åŒºåˆ«åœ¨äºmocç³»ç»Ÿ<blockquote>
<p><code>The Meta-Object Compiler, moc, is the program that handles Qt&#39;s C++ extensions. The moc tool reads a C++ header file. If it finds one or more class declarations that contain the Q_OBJECT macro, it produces a C++ source file containing the meta-object code for those classes. Among other things, meta-object code is required for the signals and slots mechanism, the run-time type information, and the dynamic property system </code></p>
</blockquote>
</li>
</ul>
<p>å…ƒå¯¹è±¡ç¼–è¯‘å™¨æ˜¯å¤„ç†Qtçš„C++æ‹“å±•ç¨‹åºï¼Œ mocå·¥å…·è¯»å–C++å¤´æ–‡ä»¶ï¼Œå¦‚æœåœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªQ_OBJECTå®ï¼Œå®ƒå°†ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«å¯¹åº”ç±»å…ƒå¯¹è±¡ä»£ç çš„C++æºæ–‡ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå…ƒå¯¹è±¡ä»£ç æ˜¯ä¿¡å·æ§½æœºåˆ¶ã€è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ã€åŠ¨æ€å±æ€§ç³»ç»Ÿæ‰€å¿…é¡»çš„ã€‚<br>ä¸€ä¸ªæœ€ç®€å•çš„ä¸å¸¦ç•Œé¢å’Œèµ„æºæ–‡ä»¶ï¼Œåªä½¿ç”¨ä¿¡å·æ§½æœºåˆ¶çš„Qtç¨‹åºçš„ç¼–è¯‘è¿‡ç¨‹å°±æ˜¯ï¼Œåœ¨æ™®é€šC++ç¨‹åºç¼–è¯‘çš„è¿‡ç¨‹å‰å¯¹åŒ…å«Q_OBJECTçš„ç±»ä½¿ç”¨mocå·¥å…·ç”Ÿæˆå¯¹åº”çš„å…ƒå¯¹è±¡ä»£ç ï¼Œå³ å…ƒå¯¹è±¡ç¼–è¯‘-&gt;é¢„å¤„ç†-&gt;ç¼–è¯‘-&gt;æ±‡ç¼–-&gt;é“¾æ¥ã€‚<br>ä¸‹é¢ç”¨ä¸€ä¸ªä¾‹å­æ¥éªŒè¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">testSignalSlot</span><br><span class="line">â”œâ”€â”€ main.cpp</span><br><span class="line">â”œâ”€â”€ reciver.cpp</span><br><span class="line">â”œâ”€â”€ reciver.h</span><br><span class="line">â”œâ”€â”€ sender.cpp</span><br><span class="line">â””â”€â”€ sender.h</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//reciver.h</span><br><span class="line">#ifndef RECIVER_H</span><br><span class="line">#define RECIVER_H</span><br><span class="line"></span><br><span class="line">#include &lt;QObject&gt;</span><br><span class="line"></span><br><span class="line">class Reciver : public QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line">public:</span><br><span class="line">    explicit Reciver(QObject *parent = nullptr);</span><br><span class="line">public slots:</span><br><span class="line">    void recive();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#endif // RECIVER_H</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//reciver.cpp</span><br><span class="line">#include &quot;reciver.h&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;QDebug&gt;</span><br><span class="line">Reciver::Reciver(QObject *parent) : QObject(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Reciver::recive()</span><br><span class="line">&#123;</span><br><span class="line">    qDebug()&lt;&lt;&quot;Hello Qt!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//sender.h</span><br><span class="line">#ifndef SENDER_H</span><br><span class="line">#define SENDER_H</span><br><span class="line"></span><br><span class="line">#include &lt;QObject&gt;</span><br><span class="line"></span><br><span class="line">class Sender : public QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line">public:</span><br><span class="line">    explicit Sender(QObject *parent = nullptr);</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    void send();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#endif // SENDER_H</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//sender.cpp</span><br><span class="line">#include &quot;sender.h&quot;</span><br><span class="line"></span><br><span class="line">Sender::Sender(QObject *parent) : QObject(parent)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">main.cpp</span><br><span class="line">#include &lt;QCoreApplication&gt;</span><br><span class="line"></span><br><span class="line">#include &quot;sender.h&quot;</span><br><span class="line">#include &quot;reciver.h&quot;</span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line">    Sender sender;</span><br><span class="line">    Reciver reciver;</span><br><span class="line">    QObject::connect(&amp;sender, &amp;Sender::send,</span><br><span class="line">                     &amp;reciver, &amp;Reciver::recive);</span><br><span class="line">    emit sender.send();</span><br><span class="line">    return a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆä½¿ç”¨mocå·¥å…·ä¸ºsender å’Œ reciver ç”Ÿæˆmocä»£ç  mocè·¯å¾„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Qt\5.15.2\mingw81_64\bin\moc.exe</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œmoc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ moc sender.h -o moc_sender.cpp</span><br><span class="line">$ moc reciver.h -o moc_reciver.cpp</span><br></pre></td></tr></table></figure>

<p>å®Œæˆåç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">testSignalSlot</span><br><span class="line">â”œâ”€â”€ main.cpp</span><br><span class="line">â”œâ”€â”€ moc_reciver.cpp     (mocç”Ÿæˆä»£ç )</span><br><span class="line">â”œâ”€â”€ moc_sender.cpp      (mocç”Ÿæˆä»£ç )</span><br><span class="line">â”œâ”€â”€ reciver.cpp</span><br><span class="line">â”œâ”€â”€ reciver.h</span><br><span class="line">â”œâ”€â”€ sender.cpp</span><br><span class="line">â””â”€â”€ sender.h</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨g++ç”Ÿæˆç›®æ ‡æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -c  -IC:\\Qt\\5.15.2\\mingw81_64\\include -IC:\\Qt\\5.15.2\\mingw81_64\\include\\QtCore  -o reciver.o reciver.cpp</span><br><span class="line">$ g++ -c  -IC:\\Qt\\5.15.2\\mingw81_64\\include -IC:\\Qt\\5.15.2\\mingw81_64\\include\\QtCore  -o sender.o sender.cpp</span><br><span class="line">$ g++ -c  -IC:\\Qt\\5.15.2\\mingw81_64\\include -IC:\\Qt\\5.15.2\\mingw81_64\\include\\QtCore  -o moc_reciver.o moc_reciver.cpp</span><br><span class="line">$ g++ -c  -IC:\\Qt\\5.15.2\\mingw81_64\\include -IC:\\Qt\\5.15.2\\mingw81_64\\include\\QtCore  -o moc_sender.o moc_sender.cpp</span><br><span class="line">$ g++ -c  -IC:\\Qt\\5.15.2\\mingw81_64\\include -IC:\\Qt\\5.15.2\\mingw81_64\\include\\QtCore  -o main.o main.cpp</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -o testSignalSlot.exe main.o reciver.o sender.o moc_reciver.o moc_sender.o  C:\\Qt\\5.15.2\\mingw81_64\\lib\\libQt5Core.a</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ°æ­¤ç¼–è¯‘å®Œæˆï¼Œå®Œæˆåç›®å½•:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">testSignalSlot</span><br><span class="line">â”œâ”€â”€ testSignalSlot.exe</span><br><span class="line">â”œâ”€â”€ main.cpp</span><br><span class="line">â”œâ”€â”€ main.o</span><br><span class="line">â”œâ”€â”€ moc_reciver.cpp</span><br><span class="line">â”œâ”€â”€ moc_reciver.o</span><br><span class="line">â”œâ”€â”€ moc_sender.cpp</span><br><span class="line">â”œâ”€â”€ moc_sender.o</span><br><span class="line">â”œâ”€â”€ reciver.cpp</span><br><span class="line">â”œâ”€â”€ reciver.h</span><br><span class="line">â”œâ”€â”€ reciver.o</span><br><span class="line">â”œâ”€â”€ sender.cpp</span><br><span class="line">â”œâ”€â”€ sender.h</span><br><span class="line">â””â”€â”€ sender.o</span><br></pre></td></tr></table></figure>

<p>è¿è¡ŒéªŒè¯ä¸€ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./testSignalSlot.exe</span><br><span class="line">Hello Qt!</span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æ ‡å‡†C-å®Œæˆä¸€ä¸ªç®€æ˜“çš„ä¿¡å·æ§½"><a href="#ç”¨æ ‡å‡†C-å®Œæˆä¸€ä¸ªç®€æ˜“çš„ä¿¡å·æ§½" class="headerlink" title="ç”¨æ ‡å‡†C++å®Œæˆä¸€ä¸ªç®€æ˜“çš„ä¿¡å·æ§½"></a>ç”¨æ ‡å‡†C++å®Œæˆä¸€ä¸ªç®€æ˜“çš„ä¿¡å·æ§½</h2><p>ç»è¿‡ç¬¬ä¸€éƒ¨åˆ†çš„äº†è§£åï¼Œæˆ‘ä»¬çŸ¥é“å…ƒå¯¹è±¡ç³»ç»Ÿä¼šä½¿ç”¨mocå·¥å…·å¯¹å¸¦æœ‰Q_OBJECTå®çš„å¤´æ–‡ä»¶ç”Ÿæˆä¸€ä»½å¸¦æœ‰å…ƒå¯¹è±¡ä¿¡æ¯çš„moc_xxx.cppæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¯ä»¥æ‰‹åŠ¨ç¼–å†™moc_xxx.cppä»£ç ,æ¥å®Œæˆmocæ‰€åšçš„äº‹æƒ…ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨æ ‡å‡†C++æ¥å®ç°ä¸€ä¸ªç®€æ˜“çš„ä¿¡å·æ§½æœºåˆ¶ï¼Œç”¨ä»¥ç®€å•è¯´æ˜ä¿¡å·æ§½çš„å®ç°åŸç†ã€‚å°†æ‰‹åŠ¨ç¼–å†™ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼Œæ ·ä¾‹ä»£ç ä¸Šä¼ åœ¨githubä¸Šã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/liujianfengv/iso-cpp-reimp-signal-slot">iso-cpp-reimp-signal-slot</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ main.cpp</span><br><span class="line">â”œâ”€â”€ moc_object.cpp</span><br><span class="line">â”œâ”€â”€ object.cpp</span><br><span class="line">â”œâ”€â”€ object.h</span><br></pre></td></tr></table></figure>

<p>ä¿¡å·æ§½çš„å®ç°å¤§è‡´éœ€è¦ä»¥ä¸‹å‡ ç‚¹</p>
<ul>
<li>ç±»ä¸­åº”è¯¥ä¿å­˜æœ‰ä¿¡å·å’Œæ§½çš„å­—ç¬¦ä¸²ä¿¡æ¯</li>
<li>å­—ç¬¦ä¸²å’Œä¿¡å·æ§½å‡½æ•°è¦å…³è”ï¼Œæœ‰å¯¹åº”å…³ç³»</li>
<li>ç±»å®ä¾‹ä¸­åº”è¯¥å­˜æœ‰ä¿¡å·å’Œç›‘å¬è¯¥ä¿¡å·çš„reciverå’Œæ§½å‡½æ•°çš„ä¿¡æ¯ï¼Œé€šè¿‡connectå€ŸåŠ©å­—ç¬¦ä¸²å®Œæˆå¯¹è±¡é—´ä¿¡å·å’Œæ§½çš„å…³è”</li>
<li>ä¿¡å·è§¦å‘æ—¶é€šè¿‡ä¸Šè¿°ä¿¡æ¯å®Œæˆæ§½å‡½æ•°çš„è°ƒç”¨</li>
</ul>
<p>æ‰€ä»¥ï¼Œé¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢å­˜æ”¾ä¿¡å·å’Œæ§½çš„åç§°ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//object.h</span><br><span class="line">struct MetaObject</span><br><span class="line">&#123;</span><br><span class="line">    const char * sig_names;     //å­˜æ”¾ä¿¡å·å‡½æ•°å­—ç¬¦ä¸²</span><br><span class="line">    const char * slts_names;    //å­˜æ”¾æ§½å‡½æ•°å­—ç¬¦ä¸²</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”å°†å…¶ä½œä¸ºä¸€ä¸ªé™æ€æˆå‘˜å˜é‡æ”¾å…¥Objectç±»ä¸­,è¿™æ ·æ‰€æœ‰Objectçš„å®ä¾‹å°±éƒ½æ‹¥æœ‰äº†ä¿¡å·å’Œæ§½çš„å­—ç¬¦ä¸²ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//object.h</span><br><span class="line">class Object</span><br><span class="line">&#123;</span><br><span class="line">    static MetaObject meta;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œåœ¨è‡ªå·±ç”Ÿæˆçš„moc_object.cppæ–‡ä»¶ä¸­å¡«å……è¿™ä¸ªç»“æ„ä½“ä¿¡æ¯ï¼Œ å½“æœ‰å¤šä¸ªä¿¡å·æˆ–æ§½æ—¶ï¼Œæˆ‘ä»¬çº¦å®šå°†æ‰€æœ‰ä¿¡å·çš„å­—ç¬¦ä¸²è¿æ¥èµ·æ¥å¹¶ç”¨â€™\nâ€™åˆ†å‰²ï¼Œè¿™æ ·æ¯ä¸ªä¿¡å·æˆ–æ§½å°±æœ‰äº†ä¸€ä¸ªå¯¹åº”çš„ç´¢å¼•ä¿¡æ¯ã€‚ ç¤ºä¾‹ä¸­ä½¿ç”¨ä¿¡å· click å’Œ æ§½å‡½æ•° onClick </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//moc_object.cpp</span><br><span class="line">static const char sig_names[] = &quot;click\n&quot;;</span><br><span class="line">static const char slts_names[] = &quot;onClick\n&quot;;</span><br><span class="line">MetaObject Object::meta = &#123;sig_names, slts_names&#125;;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ä¸ºæ¯ä¸ªå¯¹è±¡ä¿å­˜è¿æ¥ä¿¡æ¯ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ã€‚å¹¶å®šä¹‰ä¸€ä¸ªmutimapä½œä¸ºObjectçš„ç§æœ‰æˆå‘˜å˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//object.h</span><br><span class="line">struct Connection</span><br><span class="line">&#123;</span><br><span class="line">    Object *receiver;</span><br><span class="line">    int method;         //æ§½å‡½æ•°å­—ç¬¦ä¸²ç´¢å¼•</span><br><span class="line">&#125;;</span><br><span class="line">typedef std::multimap&lt;int, Connection&gt; ConnectionMap;</span><br><span class="line">...</span><br><span class="line">class Object&#123;</span><br><span class="line">    ...</span><br><span class="line">private:</span><br><span class="line">    // key:ä¿¡å·å‡½æ•°ç´¢å¼• value:è¿æ¥ä¿¡æ¯(æ¥æ”¶è€…æŒ‡é’ˆï¼Œæ¥æ”¶è€…æ§½å‡½æ•°ç´¢å¼•)</span><br><span class="line">     ConnectionMap connections;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå®šä¹‰ä¸€ä¸ªconnectæ–¹æ³•:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">void Object::connect(Object* sender, const char* sig, Object* receiver, const char* slt)</span><br><span class="line">&#123;</span><br><span class="line">    int sig_idx = find_substr_index(sender-&gt;meta.sig_names, sig);</span><br><span class="line">    int slt_idx = find_substr_index(receiver-&gt;meta.slts_names, slt);</span><br><span class="line">    if (sig_idx == -1 || slt_idx == -1) &#123;</span><br><span class="line">        perror(&quot;signal or slot not found!&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        Connection c = &#123;receiver, slt_idx&#125;;</span><br><span class="line">        sender-&gt;connections.insert(std::pair&lt;int, Connection&gt;(sig_idx, c));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤ï¼Œç±»ä¸­çš„ä¿¡å·å’Œæ§½ç›¸å…³ä¿¡æ¯éƒ½å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¿¡å·çš„è§¦å‘äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#define slots</span><br><span class="line">#define signals protected</span><br><span class="line">#define emit</span><br><span class="line">...</span><br><span class="line">signals:</span><br><span class="line">    void click();</span><br><span class="line">public slots:</span><br><span class="line">    void onClick();</span><br></pre></td></tr></table></figure>

<p>ä¿¡å·å’Œæ§½å‡½æ•°å…¶å®éƒ½æ˜¯æ™®é€šçš„å‡½æ•°ï¼Œç±»ä¼¼signalsã€slotså…³é”®å­—éƒ½åªæ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œä¿¡å·å’Œæ§½çš„åŒºåˆ«æ˜¯ï¼Œæ§½å‡½æ•°éœ€è¦æˆ‘ä»¬è‡ªå·±å»å®ç°ï¼Œè€Œä¿¡å·å‡½æ•°ä¼šç”±mocæ›¿æˆ‘ä»¬å®ç°åœ¨moc_xxx.cppæ–‡ä»¶ä¸­ï¼Œè€Œè¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å»å®ç°è¿™ä¸ªä¿¡å·å¯¹åº”çš„å‡½æ•°ã€‚<br>è¿™é‡Œåˆç”¨åˆ°ä¹‹å‰çš„å…ƒå¯¹è±¡,åœ¨å…¶ä¸­æ·»åŠ activeæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">//object.h</span><br><span class="line">struct MetaObject</span><br><span class="line">&#123;</span><br><span class="line">    const char * sig_names;     //å­˜æ”¾ä¿¡å·å‡½æ•°å­—ç¬¦ä¸²</span><br><span class="line">    const char * slts_names;    //å­˜æ”¾æ§½å‡½æ•°å­—ç¬¦ä¸²</span><br><span class="line">    static void active(Object * sender, int idx);</span><br><span class="line">&#125;;</span><br><span class="line">//object.cpp</span><br><span class="line">void MetaObject::active(Object* sender, int idx)</span><br><span class="line">&#123;</span><br><span class="line">    auto ret = sender-&gt;connections.equal_range(idx);</span><br><span class="line">    for (auto it = ret.first; it != ret.second; ++it) &#123;</span><br><span class="line">        Connection c = (*it).second;</span><br><span class="line">        //æŒ‰ç´¢å¼•è°ƒç”¨receiverå¯¹åº”çš„æ§½å‡½æ•°</span><br><span class="line">        c.receiver-&gt;metacall(c.method);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//moc_object.cpp</span><br><span class="line">void Object::click()</span><br><span class="line">&#123;</span><br><span class="line">    // 0 å³ä¸ºå½“å‰ä¿¡å·åå­—ç¬¦ä¸²åœ¨meta.sig_namesä¸­çš„ç´¢å¼•ä½ç½®</span><br><span class="line">    MetaObject::active(this, 0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//é€šè¿‡ç´¢å¼•è°ƒç”¨æ§½å‡½æ•° </span><br><span class="line">void Object::metacall(int idx)</span><br><span class="line">&#123;</span><br><span class="line">    switch (idx) &#123;</span><br><span class="line">        case 0:</span><br><span class="line">        // 0 å³ä¸ºæ­¤æ§½å‡½æ•°åå­—ç¬¦ä¸²åœ¨meta.slts_namesä¸­çš„ç´¢å¼•ä½ç½®</span><br><span class="line">            onClick();</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œä¸€ä¸ªç”¨C++å®ç°çš„ç®€å•çš„ä¿¡å·æ§½å°±å®Œæˆäº†ï¼Œç®€å•ç¼–è¯‘æµ‹è¯•ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g++ main.cpp object.cpp moc_object.cpp -o test.exe</span><br><span class="line">$ ./test.exe</span><br><span class="line">Hello Qt!</span><br></pre></td></tr></table></figure>

<p>æˆ‘ç°åœ¨ä½¿ç”¨çš„Qtç‰ˆæœ¬æ˜¯5.15.2ï¼Œä¿¡å·æ§½ç›¸å…³çš„æºä»£ç å·²ç»ç‰¹åˆ«çš„å¤šï¼Œå……æ–¥ç€å„ç§å®å’Œæ¨¡æ¿çš„å¥‡æ·«å·§è®¡ï¼Œè¿˜æœ‰å¤šçº¿ç¨‹ç­‰å…¶ä»–ç‰¹æ€§ç›¸å…³çš„ä»£ç ï¼Œçœ‹èµ·æ¥æ¯”è¾ƒåƒåŠ›ï¼Œä½†ä¹Ÿå¯ä»¥çœ‹åˆ°ä¿¡å·æ§½æœ€åŸºæœ¬çš„æ¦‚å¿µå¤§ä½“å¦‚æ­¤ã€‚è¿™ç¯‡æ–‡ç« å°±å…ˆåˆ°è¿™é‡Œï¼Œåç»­å¯èƒ½ä¼šå†™ä¸€ç¯‡å¯¹Qt5.15.2æºä»£ç ä¸­ä¿¡å·æ§½æœºåˆ¶å…·ä½“å®ç°çš„åˆ†æã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a target="_blank" rel="noopener" href="https://doc.qt.io/archives/qt-4.8/moc.html">Using the Meta-Object Compiler (moc)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/dbzhang800/article/details/6376422">ç”¨ISO C++å®ç°è‡ªå·±çš„ä¿¡å·æ§½(Qtå¦ç±»å­¦ä¹ )</a></li>
</ul>
</div>
        
  </div>

    <div class="post_tags">
      
        <i class="fas fa-tag"></i> <a href="/tags/Qt/" class="tag">Qt</a>
      
    </div>
    <div class="post-nav">
      
        <div class="post-nav-prev post-nav-item">
            <a href="/2021/11/08/MQTT%E5%9F%BA%E7%A1%80%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-%E4%B8%80-MQTT%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/" >MQTTåŸºç¡€æ–‡æ¡£ç¿»è¯‘(ä¸€):MQTTåè®®ä»‹ç»<i class="fa fa-chevron-left"></i></a>
        </div>
      
      
    </div>
      




</article>

    
<a id="gotop" href="javascript:" title="è¿”å›é¡¶éƒ¨"><i class="fa fa-arrow-up"></i></a>
    






    
<div id="bottom-outer">
    <div id="bottom-inner">
        Â© 2020 <i class="fa fa-heart" id="heart"></i> Liujianfeng 
        <br>
        Powered by 
        <a target="_blank" rel="noopener" href="http://hexo.io">hexo</a> | Theme is <a target="_blank" rel="noopener" href="https://github.com/a2396837/hexo-theme-blank/">white</a>
        
          <div class="icp-info">
            
          <a href="" target="_blank"> </a>
        </div>
        
    </div>  
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/layui-src@2.5.5/dist/layui.min.js"></script>



  
    <script src="/js/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
  

 



  <script>
    window.lazyLoadOptions = {
      elements_selector: 'img',
      threshold: 0
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script>   
  


  <script>
    var images = $('img').not('.nav-logo img').not('.card img').not($('a>img')).not('.reward-content img')
    images.each(function (i, o) {
      var lazyloadSrc = $(o).attr('data-src') ? $(o).attr('data-src') : $(o).attr('src')
      $(o).wrap(`<a href="${lazyloadSrc}" data-fancybox="group" data-caption="${$(o).attr('alt')}" class="fancybox"></a>`)
    })
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script>
  <script>
        $().fancybox({
      selector: '[data-fancybox]',
      loop: true,
      transitionEffect: 'slide',
      protect: true,
      buttons: ['slideShow', 'fullScreen', 'thumbs', 'close']
    })
  </script>   
  










  <script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script>
  




  
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js"></script>
<script>
!function (e, t, a) {
  var initCopyCode = function(){
    var copyHtml = '';
    copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
    copyHtml += '  <i class="fa fa-clipboard"></i><span>å¤åˆ¶</span>';
    copyHtml += '</button>';
    $(".highlight .code pre").before(copyHtml);
    new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
  }
  initCopyCode();
}(window, document);
</script>  
  

<script>
  var btntop = $('#gotop');
  btntop.on('click', function (e) {
    e.preventDefault();
    $('html, body').animate({ scrollTop: 0 }, '300');
  });

  var $table = $('.content table').not($('figure.highlight > table'))
$table.each(function () {
  $(this).wrap('<div class="table-wrap"></div>')
})
</script>



</html>